# üîÑ Fluxos Funcionais - EscalaMedica2

> **Objetivo**: Documentar os fluxos principais do sistema, mostrando a sequ√™ncia de a√ß√µes, decis√µes e integra√ß√µes entre m√≥dulos para facilitar desenvolvimento, testes e auditoria.

## üìä Informa√ß√µes dos Fluxos
- **Sistema**: EscalaMedica2
- **Total de Fluxos**: 8 principais
- **√öltima Atualiza√ß√£o**: 2025-10-20
- **Formato**: Diagrama textual + BPMN descritivo

---

## üìã √çndice
- [üè• Fluxos de Admiss√£o](#-fluxos-de-admiss√£o)
- [üìÖ Fluxos de Escalas](#-fluxos-de-escalas)
- [ü©∫ Fluxos de Atendimento](#-fluxos-de-atendimento)
- [üí∞ Fluxos Financeiros](#-fluxos-financeiros)
- [üîê Fluxos de Seguran√ßa](#-fluxos-de-seguran√ßa)
- [üìä Fluxos de Gest√£o](#-fluxos-de-gest√£o)

---

## üè• Fluxos de Admiss√£o

### üö™ F001 - Cadastro de Paciente

```mermaid
flowchart TD
    A[Recep√ß√£o inicia cadastro] --> B{Paciente existe?}
    B -->|Sim| C[Atualizar dados]
    B -->|N√£o| D[Novo cadastro]
    
    D --> E[Validar CPF]
    E --> F{CPF v√°lido?}
    F -->|N√£o| G[Solicitar documento alternativo]
    F -->|Sim| H[Inserir dados pessoais]
    
    H --> I[Selecionar conv√™nio]
    I --> J{Conv√™nio v√°lido?}
    J -->|N√£o| K[Configurar particular]
    J -->|Sim| L[Validar carteirinha]
    
    C --> M[Dados atualizados]
    K --> M
    L --> M
    
    M --> N[Gerar pulseira]
    N --> O[Paciente cadastrado]
    
    G --> P[Cadastro manual]
    P --> H
```

#### Detalhes do Fluxo:
- **Ator Principal**: Recepcionista
- **Pr√©-condi√ß√µes**: Sistema funcionando, recepcionista autenticado
- **P√≥s-condi√ß√µes**: Paciente cadastrado com n√∫mero √∫nico
- **Tempo M√©dio**: 3-5 minutos
- **Sistemas Integrados**: SUS (valida√ß√£o CPF), Conv√™nios (valida√ß√£o carteirinha)

#### Regras Aplicadas:
- RN003: Valida√ß√£o de CPF obrigat√≥ria
- RN016: Verificar cobertura do conv√™nio
- RN019: Log de auditoria para cadastros

#### Pontos de Falha:
- API do SUS indispon√≠vel ‚Üí Permitir cadastro manual
- Sistema de conv√™nio offline ‚Üí Marcar para valida√ß√£o posterior
- Duplica√ß√£o de paciente ‚Üí Merge autom√°tico com confirma√ß√£o

---

### üè• F002 - Interna√ß√£o de Paciente

```mermaid
flowchart TD
    A[M√©dico solicita interna√ß√£o] --> B[Verificar leitos dispon√≠veis]
    B --> C{H√° vaga no setor?}
    C -->|N√£o| D[Listar setores alternativos]
    C -->|Sim| E[Reservar leito]
    
    D --> F{Aceita alternativa?}
    F -->|N√£o| G[Entrar em fila de espera]
    F -->|Sim| E
    
    E --> H[Validar autoriza√ß√£o conv√™nio]
    H --> I{Autoriza√ß√£o OK?}
    I -->|N√£o| J[Solicitar autoriza√ß√£o]
    I -->|Sim| K[Confirmar interna√ß√£o]
    
    J --> L{Autoriza√ß√£o recebida?}
    L -->|N√£o| M[Cancelar interna√ß√£o]
    L -->|Sim| K
    
    K --> N[Atualizar status leito]
    N --> O[Gerar pulseira]
    O --> P[Notificar equipe]
    P --> Q[Paciente internado]
    
    G --> R[Aguardar vaga]
    M --> S[Interna√ß√£o cancelada]
```

#### Detalhes do Fluxo:
- **Ator Principal**: M√©dico assistente
- **Atores Secund√°rios**: Recep√ß√£o, Enfermagem
- **Tempo M√©dio**: 15-30 minutos
- **Sistemas Integrados**: Sistema de leitos, Conv√™nios, Notifica√ß√µes

#### Regras Aplicadas:
- RN005: Verificar capacidade do setor
- RN006: Leito ocupado n√£o pode ser usado
- RN017: Autoriza√ß√£o para procedimentos caros

---

## üìÖ Fluxos de Escalas

### üìã F003 - Cria√ß√£o de Escala Mensal

```mermaid
flowchart TD
    A[Coordenador inicia escala] --> B[Definir per√≠odo]
    B --> C[Listar m√©dicos dispon√≠veis]
    C --> D[Verificar prefer√™ncias]
    D --> E[Gerar escala autom√°tica]
    
    E --> F[Validar conflitos]
    F --> G{H√° conflitos?}
    G -->|Sim| H[Resolver conflitos]
    G -->|N√£o| I[Verificar cobertura]
    
    H --> J[Ajustar manualmente]
    J --> F
    
    I --> K{Cobertura completa?}
    K -->|N√£o| L[Identificar gaps]
    K -->|Sim| M[Salvar rascunho]
    
    L --> N[Solicitar plant√µes extras]
    N --> O{M√©dicos aceitaram?}
    O -->|N√£o| P[Redistribuir plant√µes]
    O -->|Sim| M
    
    P --> I
    
    M --> Q[Enviar para aprova√ß√£o]
    Q --> R[Diretor m√©dico avalia]
    R --> S{Aprovado?}
    S -->|N√£o| T[Retornar para ajustes]
    S -->|Sim| U[Publicar escala]
    
    T --> H
    U --> V[Notificar m√©dicos]
    V --> W[Escala ativa]
```

#### Detalhes do Fluxo:
- **Ator Principal**: Coordenador de escalas
- **Aprovador**: Diretor m√©dico
- **Prazo**: At√© 25 do m√™s anterior
- **Sistemas Integrados**: Email, SMS, Sistema de prefer√™ncias

#### Regras Aplicadas:
- RN008: Validar plant√µes sobrepostos
- RN009: Verificar limite de horas
- RN010: Respeitar intervalo entre plant√µes
- RN011: Garantir cobertura completa

---

### üîÑ F004 - Troca de Plant√£o

```mermaid
flowchart TD
    A[M√©dico solicita troca] --> B[Selecionar plant√£o]
    B --> C[Buscar substituto]
    C --> D{Encontrou substituto?}
    D -->|N√£o| E[Expandir busca]
    D -->|Sim| F[Validar elegibilidade]
    
    E --> G[Notificar outros m√©dicos]
    G --> H{Algu√©m se ofereceu?}
    H -->|N√£o| I[Troca negada]
    H -->|Sim| F
    
    F --> J{Substituto v√°lido?}
    J -->|N√£o| K[Justificar recusa]
    J -->|Sim| L[Enviar proposta]
    
    L --> M[Substituto avalia]
    M --> N{Aceita troca?}
    N -->|N√£o| O[Buscar outro]
    N -->|Sim| P[Validar regras]
    
    P --> Q{Troca permitida?}
    Q -->|N√£o| R[Explicar impedimento]
    Q -->|Sim| S[Supervisor aprova]
    
    S --> T{Aprovado?}
    T -->|N√£o| U[Troca rejeitada]
    T -->|Sim| V[Efetivar troca]
    
    V --> W[Atualizar escala]
    W --> X[Notificar envolvidos]
    X --> Y[Troca conclu√≠da]
    
    K --> C
    O --> C
    I --> Z[Processo encerrado]
    R --> Z
    U --> Z
```

#### Detalhes do Fluxo:
- **Ator Principal**: M√©dico solicitante
- **Tempo Limite**: 48h antes do plant√£o
- **Aprova√ß√£o**: Supervisor do setor

#### Regras Aplicadas:
- RN008: Validar sobreposi√ß√£o
- RN009: Verificar limite de horas de ambos
- RN010: Respeitar intervalo m√≠nimo

---

## ü©∫ Fluxos de Atendimento

### üöë F005 - Atendimento de Emerg√™ncia

```mermaid
flowchart TD
    A[Paciente chega na emerg√™ncia] --> B[Triagem inicial]
    B --> C[Aferir sinais vitais]
    C --> D[Classificar risco]
    D --> E{Classifica√ß√£o}
    
    E -->|Azul| F[Aguardar 4h]
    E -->|Verde| G[Aguardar 2h]
    E -->|Amarelo| H[Aguardar 1h]
    E -->|Laranja| I[Aguardar 10min]
    E -->|Vermelho| J[Atendimento imediato]
    
    F --> K[Verificar m√©dico dispon√≠vel]
    G --> K
    H --> K
    I --> K
    J --> K
    
    K --> L{M√©dico livre?}
    L -->|N√£o| M[Aguardar na fila]
    L -->|Sim| N[Iniciar atendimento]
    
    M --> O[Monitor tempo espera]
    O --> P{Tempo excedido?}
    P -->|Sim| Q[Reclassificar urg√™ncia]
    P -->|N√£o| L
    
    Q --> K
    
    N --> R[Anamnese e exame]
    R --> S[Solicitar exames]
    S --> T{Exames necess√°rios?}
    T -->|Sim| U[Aguardar resultados]
    T -->|N√£o| V[Definir conduta]
    
    U --> W[Resultados prontos?]
    W -->|N√£o| X[Continuar aguardando]
    W -->|Sim| V
    
    X --> W
    
    V --> Y{Conduta}
    Y -->|Alta| Z[Prescrever medicamentos]
    Y -->|Interna√ß√£o| AA[Solicitar leito]
    Y -->|Transfer√™ncia| BB[Contatar hospital]
    Y -->|Cirurgia| CC[Agendar centro cir√∫rgico]
    
    Z --> DD[Alta do paciente]
    AA --> EE[Aguardar vaga]
    BB --> FF[Aguardar transporte]
    CC --> GG[Aguardar agenda]
    
    EE --> HH[Vaga dispon√≠vel?]
    HH -->|Sim| II[Transferir para interna√ß√£o]
    HH -->|N√£o| EE
```

#### Detalhes do Fluxo:
- **Ator Principal**: Equipe de emerg√™ncia
- **Tempo Cr√≠tico**: Conforme classifica√ß√£o Manchester
- **Sistemas Integrados**: Laborat√≥rio, Radiologia, Interna√ß√£o

#### Regras Aplicadas:
- RN012: Triagem obrigat√≥ria
- RN013: Tempos por classifica√ß√£o
- RN014: M√©dico da especialidade quando poss√≠vel

---

### üìÖ F006 - Agendamento de Consulta

```mermaid
flowchart TD
    A[Paciente solicita consulta] --> B[Verificar conv√™nio]
    B --> C{Conv√™nio cobre?}
    C -->|N√£o| D[Orientar sobre particular]
    C -->|Sim| E[Selecionar especialidade]
    
    D --> F{Aceita particular?}
    F -->|N√£o| G[Cancelar agendamento]
    F -->|Sim| E
    
    E --> H[Buscar m√©dicos dispon√≠veis]
    H --> I{H√° vagas?}
    I -->|N√£o| J[Entrar em lista de espera]
    I -->|Sim| K[Mostrar op√ß√µes]
    
    K --> L[Paciente escolhe]
    L --> M[Confirmar agendamento]
    M --> N[Gerar comprovante]
    N --> O[Enviar lembrete]
    O --> P[Consulta agendada]
    
    J --> Q[Aguardar cancelamento]
    Q --> R{Vaga liberada?}
    R -->|Sim| S[Notificar paciente]
    R -->|N√£o| Q
    
    S --> T{Paciente confirma?}
    T -->|Sim| M
    T -->|N√£o| Q
```

#### Detalhes do Fluxo:
- **Ator Principal**: Recepcionista ou Paciente (online)
- **Anteced√™ncia M√≠nima**: 24 horas
- **Sistema Integrado**: Email, SMS, Conv√™nios

#### Regras Aplicadas:
- RN015: N√£o agendar no passado
- RN016: Verificar cobertura do conv√™nio

---

## üí∞ Fluxos Financeiros

### üí≥ F007 - Faturamento Mensal

```mermaid
flowchart TD
    A[In√≠cio do m√™s] --> B[Coletar procedimentos]
    B --> C[Agrupar por conv√™nio]
    C --> D[Validar autoriza√ß√µes]
    D --> E{Autoriza√ß√µes OK?}
    E -->|N√£o| F[Solicitar pendentes]
    E -->|Sim| G[Calcular valores]
    
    F --> H[Aguardar resposta]
    H --> I{Autoriza√ß√£o recebida?}
    I -->|Sim| G
    I -->|N√£o| J[Excluir do lote]
    
    J --> G
    
    G --> K[Aplicar tabela pre√ßos]
    K --> L[Gerar arquivo TISS]
    L --> M[Validar formato]
    M --> N{Arquivo v√°lido?}
    N -->|N√£o| O[Corrigir erros]
    N -->|Sim| P[Enviar para conv√™nio]
    
    O --> L
    
    P --> Q[Aguardar retorno]
    Q --> R{Aprovado?}
    R -->|N√£o| S[Analisar glosas]
    R -->|Sim| T[Registrar a receber]
    
    S --> U[Corrigir itens glosados]
    U --> V[Reenviar lote]
    V --> Q
    
    T --> W[Gerar relat√≥rio]
    W --> X[Faturamento conclu√≠do]
```

#### Detalhes do Fluxo:
- **Respons√°vel**: Equipe financeira
- **Prazo**: At√© 5¬∫ dia √∫til
- **Sistemas Integrados**: TISS, Sistema dos conv√™nios

#### Regras Aplicadas:
- RN017: Verificar autoriza√ß√µes necess√°rias
- RN018: Respeitar prazo de fechamento

---

## üîê Fluxos de Seguran√ßa

### üîê F008 - Login e Autentica√ß√£o

```mermaid
flowchart TD
    A[Usu√°rio acessa sistema] --> B[Inserir credenciais]
    B --> C[Validar formato]
    C --> D{Formato v√°lido?}
    D -->|N√£o| E[Mostrar erro formato]
    D -->|Sim| F[Verificar no banco]
    
    F --> G{Usu√°rio existe?}
    G -->|N√£o| H[Usu√°rio n√£o encontrado]
    G -->|Sim| I[Validar senha]
    
    I --> J{Senha correta?}
    J -->|N√£o| K[Incrementar tentativas]
    J -->|Sim| L[Verificar status]
    
    K --> M{Max tentativas?}
    M -->|Sim| N[Bloquear conta]
    M -->|N√£o| O[Tentar novamente]
    
    L --> P{Usu√°rio ativo?}
    P -->|N√£o| Q[Conta inativa]
    P -->|Sim| R[Verificar 2FA]
    
    R --> S{2FA habilitado?}
    S -->|N√£o| T[Criar sess√£o]
    S -->|Sim| U[Solicitar c√≥digo]
    
    U --> V[Usu√°rio insere c√≥digo]
    V --> W{C√≥digo v√°lido?}
    W -->|N√£o| X[C√≥digo inv√°lido]
    W -->|Sim| T
    
    T --> Y[Registrar login]
    Y --> Z[Redirecionar dashboard]
    
    E --> AA[Retornar ao login]
    H --> AA
    O --> AA
    N --> BB[Contatar admin]
    Q --> BB
    X --> U
```

#### Detalhes do Fluxo:
- **Tempo de Sess√£o**: 30 minutos inatividade
- **M√°ximo Tentativas**: 5 tentativas
- **2FA**: Obrigat√≥rio para administradores

#### Regras Aplicadas:
- RN003: Senha forte obrigat√≥ria
- RN004: Bloqueio por inatividade
- RN021: Expira√ß√£o de sess√£o

---

## üìä Uso dos Fluxos

### üë©‚Äçüíª Para Desenvolvedores
1. **Implementa√ß√£o**: Use os fluxos como base para desenvolvimento
2. **Valida√ß√£o**: Verifique se o c√≥digo segue o fluxo documentado
3. **Testes**: Crie cen√°rios de teste baseados nos fluxos
4. **Debug**: Use fluxos para rastrear problemas

### üß™ Para QA
1. **Cen√°rios de Teste**: Cada fluxo gera m√∫ltiplos cen√°rios
2. **Caminhos Alternativos**: Teste todos os "N√£o" dos fluxos
3. **Pontos de Falha**: Foque nos pontos cr√≠ticos identificados
4. **Integra√ß√£o**: Valide integra√ß√£o entre sistemas

### üìã Para Product Owners
1. **Valida√ß√£o**: Confirme se fluxo atende requisitos
2. **Otimiza√ß√£o**: Identifique gargalos e melhorias
3. **Comunica√ß√£o**: Use para explicar funcionalidades
4. **Aprova√ß√£o**: Base para aceitar/rejeitar implementa√ß√µes

### üë• Para Stakeholders
1. **Entendimento**: Visualize como o sistema funciona
2. **Impacto**: Entenda como mudan√ßas afetam processos
3. **Treinamento**: Base para capacita√ß√£o de usu√°rios
4. **Auditoria**: Rastree conformidade com processos

---

## üîÑ Manuten√ß√£o dos Fluxos

### ‚úÖ Quando Atualizar
- Nova funcionalidade implementada
- Mudan√ßa em regra de neg√≥cio
- Integra√ß√£o com novo sistema
- Otimiza√ß√£o de processo
- Feedback dos usu√°rios

### üìù Como Atualizar
1. **Identificar Mudan√ßa**: O que mudou no processo
2. **Mapear Impacto**: Quais fluxos s√£o afetados
3. **Atualizar Diagrama**: Modificar passos e decis√µes
4. **Validar Regras**: Verificar regras de neg√≥cio relacionadas
5. **Comunicar**: Informar equipe sobre mudan√ßas

### üéØ M√©tricas dos Fluxos
- **Tempo M√©dio**: Quanto tempo cada fluxo demora
- **Taxa de Sucesso**: % de fluxos conclu√≠dos com sucesso
- **Pontos de Falha**: Onde os fluxos mais falham
- **Gargalos**: Etapas que mais demoram

---

## üìû Ferramentas Recomendadas

### üé® Para Diagrama√ß√£o
- **Mermaid**: Texto ‚Üí Diagrama (usado neste doc)
- **Draw.io**: Editor visual gratuito
- **Lucidchart**: Ferramenta profissional
- **Bizagi**: Espec√≠fico para BPMN

### üîó Para Integra√ß√£o
- **Postman**: Testar APIs dos fluxos
- **Insomnia**: Alternativa ao Postman
- **Swagger**: Documentar APIs
- **Newman**: Automatizar testes de API

---

**üìç √öltima atualiza√ß√£o**: 2025-10-20  
**üë• Respons√°veis**: Product Owner + Tech Lead + Analistas de Processo  
**üìã Status**: Fluxos principais mapeados - detalhar conforme implementa√ß√£o  
**üîÑ Pr√≥xima revis√£o**: A cada nova funcionalidade ou mudan√ßa de processo

> **üí° Dica**: Use estes fluxos como base para criar user stories e casos de teste!